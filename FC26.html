    <!DOCTYPE html>
    <html lang="tr">
    <head>
    <meta charset="UTF-8" />
    <title>Mini Haxball Gelişmiş</title>
    <style>
        body {
        margin: 0; background: #222; overflow: hidden; font-family: Arial, sans-serif; user-select: none;
        color: white; text-align: center;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        }
        canvas { display: block; margin: auto; background: #144214; border: 3px solid #666; }
        #scoreboard, #timer, #stats {
        margin-top: 10px;
        font-size: 24px;
        letter-spacing: 1.5px;
        user-select:none;
        }
        #message {
        margin-top: 15px;
        font-size: 32px;
        font-weight: bold;
        color: #ffcc00;
        user-select:none;
        }
        #resetBtn, #startBtn {
        margin-top: 15px;
        padding: 10px 20px;
        font-size: 18px;
        cursor: pointer;
        border: none;
        background: #ffcc00;
        color: #222;
        border-radius: 6px;
        font-weight: bold;
        transition: background 0.3s ease;
        user-select:none;
        }
        #resetBtn:hover, #startBtn:hover {
        background: #ffaa00;
        }

        #menu {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background: #111;
        padding: 20px 30px;
        border-radius: 12px;
        box-shadow: 0 0 15px #0a0;
        user-select:none;
        }

        #menu label, #menu select, #menu input {
        font-size: 18px;
        margin: 8px 0;
        display: block;
        width: 100%;
        user-select:none;
        }
        #menu input[type=text] {
        padding: 6px;
        border-radius: 6px;
        border: none;
        font-size: 18px;
        }

        /* Basit mobil joystick için stil */
        #mobileControls {
        position: fixed;
        bottom: 20px;
        width: 100%;
        display: flex;
        justify-content: space-around;
        pointer-events: none;
        user-select: none;
        -webkit-user-select: none;
        }
        .joystick {
        width: 120px;
        height: 120px;
        background: rgba(255,255,255,0.15);
        border-radius: 50%;
        position: relative;
        pointer-events: auto;
        touch-action: none;
        }
        .stick {
        position: absolute;
        width: 50px;
        height: 50px;
        background: rgba(255,255,255,0.6);
        border-radius: 50%;
        top: 35px;
        left: 35px;
        transition: top 0.1s, left 0.1s;
        }
    </style>
    </head>
    <body>

    <div id="menu">
        <h2>Mini Haxball - Oyun Ayarları</h2>
        <label for="mode">Oyun Modu:</label>
        <select id="mode">
        <option value="1v1">2 Oyuncu (1v1)</option>
        <option value="1vbot" selected>Tek Oyuncu (1vBot)</option>
        </select>

        <label for="scoreLimit">Skor Limiti (Gol sayısı):</label>
        <select id="scoreLimit">
        <option value="3">3</option>
        <option value="5" selected>5</option>
        <option value="10">10</option>
        </select>

        <label for="timeLimit">Maç Süresi (dakika):</label>
        <select id="timeLimit">
        <option value="1">1</option>
        <option value="3" selected>3</option>
        <option value="5">5</option>
        </select>

        <label for="player1Name">Kırmızı Oyuncu Adı:</label>
        <input type="text" id="player1Name" placeholder="Kırmızı" maxlength="12" />

        <label for="player2Name">Mavi Oyuncu Adı:</label>
        <input type="text" id="player2Name" placeholder="Mavi" maxlength="12" />

        <label for="ballType">Top Tipi:</label>
        <select id="ballType">
        <option value="normal" selected>Normal</option>
        <option value="heavy">Ağır</option>
        <option value="bouncy">Zıplayan</option>
        </select>

        <label for="playerSpeed">Oyuncu Hızı:</label>
        <select id="playerSpeed">
        <option value="1.5">Yavaş</option>
        <option value="2.2" selected>Normal</option>
        <option value="3">Hızlı</option>
        </select>

        <button id="startBtn">Oyunu Başlat</button>
    </div>

    <canvas id="game" width="800" height="500" style="display:none;"></canvas>
    <div id="scoreboard"></div>
    <div id="timer"></div>
    <div id="message"></div>
    <button id="resetBtn" style="display:none;">Oyunu Yeniden Başlat</button>
    <div id="stats"></div>

    <div id="mobileControls" style="display:none;">
        <div id="joystick1" class="joystick">
        <div class="stick"></div>
        </div>
        <div id="joystick2" class="joystick">
        <div class="stick"></div>
        </div>
    </div>

    <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;

    const scoreboard = document.getElementById("scoreboard");
    const message = document.getElementById("message");
    const resetBtn = document.getElementById("resetBtn");
    const timerEl = document.getElementById("timer");
    const statsEl = document.getElementById("stats");

    const startBtn = document.getElementById("startBtn");
    const menu = document.getElementById("menu");

    const keys = {};
    document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
    document.addEventListener("keydown", e => {
    keys[e.key.toLowerCase()] = true;

    // SPACE tuşuyla şut özelliği
    if (e.code === "Space" && ball && player1 && !gameOver) {
        const dx = ball.x - player1.x;
        const dy = ball.y - player1.y;
        const dist = Math.hypot(dx, dy);
        if (dist < player1.radius + ball.radius + 10) {
        const angle = Math.atan2(dy, dx);
        // Şut kuvveti (ball.maxSpeed * 1.3)
        ball.vx = Math.cos(angle) * ball.maxSpeed * 1.3;
        ball.vy = Math.sin(angle) * ball.maxSpeed * 1.3;
        playSound(hitSound);
        }
    }
    });


    // Ses efektleri
    const hitSound = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YQAAAAA=");
    const goalSound = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YQAAAAA=");

    function playSound(audio) {
        try {
        audio.currentTime = 0;
        audio.play();
        } catch {}
    }

    // LocalStorage istatistikler
    const STORAGE_KEY = "miniHaxballStats";
    let stats = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
        player1Wins: 0,
        player2Wins: 0,
        player1Goals: 0,
        player2Goals: 0,
        gamesPlayed: 0
    };

    function saveStats() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(stats));
    }

    // Player sınıfı
    class Player {
        constructor(x, y, color, controls, name, speed) {
        this.x = x;
        this.y = y;
        this.radius = 20;
        this.color = color;
        this.speed = speed;
        this.controls = controls;
        this.vx = 0;
        this.vy = 0;
        this.name = name;
        this.mobileDir = { x: 0, y: 0 };
        }

        move() {
        this.vx = 0;
        this.vy = 0;

        // Klavye kontrol
        if (!this.isBot) {
            if (keys[this.controls.up]) this.vy = -this.speed;
            if (keys[this.controls.down]) this.vy = this.speed;
            if (keys[this.controls.left]) this.vx = -this.speed;
            if (keys[this.controls.right]) this.vx = this.speed;
            // Mobil joystick kontrol
            this.vx += this.mobileDir.x * this.speed;
            this.vy += this.mobileDir.y * this.speed;
        } else {
            // Bot hareketi
            this.botMove();
        }

        // Limit hız (kare değil normal hız)
        let speedVal = Math.hypot(this.vx, this.vy);
        if (speedVal > this.speed) {
            this.vx = (this.vx / speedVal) * this.speed;
            this.vy = (this.vy / speedVal) * this.speed;
        }

        this.x += this.vx;
        this.y += this.vy;

        // Sınırlar
        this.x = Math.max(this.radius, Math.min(WIDTH - this.radius, this.x));
        this.y = Math.max(this.radius, Math.min(HEIGHT - this.radius, this.y));
        }

        botMove() {
        if (!ball) return;
        // Basit bot: topu takip eder ve kaleyi savunur
        const targetX = ball.x < WIDTH / 2 ? WIDTH - 100 : WIDTH - 200;
        const targetY = ball.y;

        // Savunma pozisyonu: top rakip sahadaysa kale önüne çekil
        let destX = targetX;
        let destY = targetY;

        // Top çok yakınsa topa saldır
        const distToBall = Math.hypot(ball.x - this.x, ball.y - this.y);
        if (distToBall < 150) {
            destX = ball.x;
            destY = ball.y;
        }

        // Basit yumuşak takip
        const dx = destX - this.x;
        const dy = destY - this.y;
        const dist = Math.hypot(dx, dy);
        if (dist > 5) {
            this.vx = (dx / dist) * this.speed;
            this.vy = (dy / dist) * this.speed;
        } else {
            this.vx = 0;
            this.vy = 0;
        }
        }

        draw() {
        ctx.beginPath();
        ctx.fillStyle = this.color;
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);

        // Top sektirme animasyonu için büyüklük animasyonu (küçük salınım)
        const scale = 1 + 0.05 * Math.sin(Date.now() / 150);
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.scale(scale, scale);
        ctx.beginPath();
        ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();

        // İsim
        ctx.fillStyle = "#fff";
        ctx.font = "bold 14px Arial";
        ctx.textAlign = "center";
        ctx.fillText(this.name, this.x, this.y - this.radius - 8);
        }
    }

    // Top sınıfı
    class Ball {
        constructor(x, y, type="normal") {
        this.x = x;
        this.y = y;
        this.radius = 12;
        this.vx = 0;
        this.vy = 0;
        this.friction = 0.95;
        this.bounceAnimTimer = 0;
        this.bounceCount = 0;
        this.type = type;

        // Farklı top tiplerine göre fizik
        switch(type) {
            case "heavy":
            this.friction = 0.92;
            this.maxSpeed = 5;
            this.radius = 14;
            break;
            case "bouncy":
            this.friction = 0.985;
            this.maxSpeed = 10;
            this.radius = 12;
            break;
            default:
            this.friction = 0.98;
            this.maxSpeed = 8;
            this.radius = 12;
        }
        }

        update(players) {
        this.x += this.vx;
        this.y += this.vy;

        // Friction
        this.vx *= this.friction;
        this.vy *= this.friction;

        // Duvar çarpışmaları
        if (this.x < this.radius) {
           this.vx = -this.vx * 0.6; // %60 hızla sek

            this.x = this.radius;
            this.bounceAnimTimer = 5;
            this.bounceCount++;
            playSound(hitSound);
        } 
        if (this.x > WIDTH - this.radius) {
            this.vx = -this.vx;
            this.x = WIDTH - this.radius;
            this.bounceAnimTimer = 5;
            this.bounceCount++;
            playSound(hitSound);
        }
        if (this.y < this.radius) {
           this.vy = -this.vy * 0.6;
            this.y = this.radius;
            this.bounceAnimTimer = 5;
            this.bounceCount++;
            playSound(hitSound);
        }
        if (this.y > HEIGHT - this.radius) {
            this.vy = -this.vy;
            this.y = HEIGHT - this.radius;
            this.bounceAnimTimer = 5;
            this.bounceCount++;
            playSound(hitSound);
        }

        // Oyuncu çarpışmaları (topa itme)
        players.forEach(p => {
            const dx = this.x - p.x;
            const dy = this.y - p.y;
            const dist = Math.hypot(dx, dy);
            if (dist < this.radius + p.radius) {
            const angle = Math.atan2(dy, dx);
            const overlap = this.radius + p.radius - dist;

            // Topu oyuncudan uzaklaştır
            this.x += Math.cos(angle) * overlap;
            this.y += Math.sin(angle) * overlap;

            // Topun hızını ayarla, oyuncu hareketine göre
            const force = 0.5;
            this.vx = Math.cos(angle) * this.maxSpeed * force + p.vx * 0.7;
            this.vy = Math.sin(angle) * this.maxSpeed * force + p.vy * 0.7;

            // Hızı sınırla
            const speed = Math.hypot(this.vx, this.vy);
            if (speed > this.maxSpeed) {
                this.vx = (this.vx / speed) * this.maxSpeed;
                this.vy = (this.vy / speed) * this.maxSpeed;
            }
            this.bounceAnimTimer = 5;
            this.bounceCount++;
            playSound(hitSound);
            }
        });

        // Bounce animasyon timer azalıyor
        if(this.bounceAnimTimer > 0) this.bounceAnimTimer--;

        // Top sektikçe hız artışı (max maxSpeed)
        if (this.bounceCount > 3) {
            const speed = Math.hypot(this.vx, this.vy);
            if (speed < this.maxSpeed) {
            this.vx *= 1.01;
            this.vy *= 1.01;
            }
        }
        }

        draw() {
        // Bounce animasyonu için büyütme-küçültme efekti
        const scale = 1 + 0.15 * Math.sin(this.bounceAnimTimer * 0.7);
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.scale(scale, scale);

        // Top tipi şekli
        if (this.type === "bouncy") {
            // Kare top
            ctx.fillStyle = "#fff";
            ctx.fillRect(-this.radius, -this.radius, this.radius*2, this.radius*2);
        } else {
            // Normal ve heavy için yuvarlak
            ctx.beginPath();
            ctx.fillStyle = "#fff";
            ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
            ctx.fill();
        }

        ctx.restore();
        }
    }

    // Oyun alanı çizimi
    function drawField() {
        // Zemini koyu yeşil yapalım
        ctx.fillStyle = "#145214";
        ctx.fillRect(0, 0, WIDTH, HEIGHT);

        // Orta çizgi
        ctx.strokeStyle = "#ddd";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(WIDTH/2, 0);
        ctx.lineTo(WIDTH/2, HEIGHT);
        ctx.stroke();

        // Kale alanları
        ctx.fillStyle = "#0b700b";
        ctx.fillRect(0, HEIGHT/2 - 70, 15, 140);
        ctx.fillRect(WIDTH - 15, HEIGHT/2 - 70, 15, 140);

        // Orta yuvarlak
        ctx.strokeStyle = "#ddd";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(WIDTH/2, HEIGHT/2, 80, 0, Math.PI*2);
        ctx.stroke();
    }

    // Global değişkenler
    let player1, player2, ball;
    let score1 = 0;
    let score2 = 0;
    let gameOver = false;
    let gameMode = "1vbot";
    let scoreLimit = 5;
    let timeLimit = 180; // saniye
    let timeLeft = timeLimit;
    let timerInterval;
    let ballType = "normal";
    let playerSpeed = 2.2;

    // Skor ve zaman güncelle
    function updateScoreboard() {
        scoreboard.textContent = `${player1.name}: ${score1}   |   ${player2.name}: ${score2}`;
    }

    function updateTimer() {
        let minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;
        timerEl.textContent = `Kalan Süre: ${minutes}:${seconds.toString().padStart(2,'0')}`;
    }

    // Top kale çizgisine geldi mi, gol var mı kontrol
    function checkGoal() {
        const goalTop = HEIGHT/2 - 70;
        const goalBottom = HEIGHT/2 + 70;

        if (ball.x - ball.radius <= 15) { // Sol kale
        if (ball.y > goalTop && ball.y < goalBottom) {
            score2++;
            updateScoreboard();
            playSound(goalSound);
            resetPositionsAfterGoal();
            stats.player2Goals++;
        }
        } else if (ball.x + ball.radius >= WIDTH - 15) { // Sağ kale
        if (ball.y > goalTop && ball.y < goalBottom) {
            score1++;
            updateScoreboard();
            playSound(goalSound);
            resetPositionsAfterGoal();
            stats.player1Goals++;
        }
        }

        if (score1 >= scoreLimit) endGame(`${player1.name} Kazandı!`);
        if (score2 >= scoreLimit) endGame(`${player2.name} Kazandı!`);
    }

    function resetPositionsAfterGoal() {
        ball.x = WIDTH / 2;
        ball.y = HEIGHT / 2;
        ball.vx = 0;
        ball.vy = 0;
        ball.bounceCount = 0;
        player1.x = 100;
        player1.y = HEIGHT / 2;
        player2.x = WIDTH - 100;
        player2.y = HEIGHT / 2;
    }

    function endGame(text) {
        gameOver = true;
        message.textContent = text;
        resetBtn.style.display = "inline-block";
        clearInterval(timerInterval);
        stats.gamesPlayed++;
        if (text.includes(player1.name)) stats.player1Wins++;
        else if (text.includes(player2.name)) stats.player2Wins++;
        saveStats();
        showStats();
    }

    function showStats() {
        statsEl.innerHTML = `<h3>İstatistikler</h3>
        <p>Toplam Oyun: ${stats.gamesPlayed}</p>
        <p>${player1.name} - Kazanma: ${stats.player1Wins} / Gol: ${stats.player1Goals}</p>
        <p>${player2.name} - Kazanma: ${stats.player2Wins} / Gol: ${stats.player2Goals}</p>
        `;
    }

    // Oyun reset
    function resetGame() {
        score1 = 0;
        score2 = 0;
        timeLeft = timeLimit;
        updateScoreboard();
        updateTimer();
        message.textContent = "";
        resetBtn.style.display = "none";
        gameOver = false;
        resetPositionsAfterGoal();
        if (gameMode === "1vbot") {
        player2.isBot = true;
        } else {
        player2.isBot = false;
        }
        statsEl.innerHTML = "";
        startTimer();
    }

    // Oyun döngüsü
    function gameLoop() {
        if (gameOver) {
        requestAnimationFrame(gameLoop);
        return;
        }

        ctx.clearRect(0, 0, WIDTH, HEIGHT);
        drawField();

        player1.move();
        player2.move();

        ball.update([player1, player2]);
        checkGoal();

        player1.draw();
        player2.draw();
        ball.draw();

        requestAnimationFrame(gameLoop);
    }

    // Timer başlat
    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
        if (!gameOver) {
            timeLeft--;
            updateTimer();
            if (timeLeft <= 0) {
            // Süre dolunca kazananı belirle
            if(score1 > score2) endGame(`${player1.name} Kazandı!`);
            else if(score2 > score1) endGame(`${player2.name} Kazandı!`);
            else endGame("Berabere!");
            }
        }
        }, 1000);
    }

    // Mobil joystick kodu
    function setupJoystick(joystickElement, player) {
        const stick = joystickElement.querySelector(".stick");
        let dragging = false;
        let origin = { x: 0, y: 0 };

        function clamp(n, min, max) {
        return Math.min(Math.max(n, min), max);
        }

        joystickElement.addEventListener("pointerdown", e => {
        dragging = true;
        origin.x = e.clientX;
        origin.y = e.clientY;
        stick.style.transition = "none";
        });

        joystickElement.addEventListener("pointermove", e => {
        if (!dragging) return;
        let dx = e.clientX - origin.x;
        let dy = e.clientY - origin.y;
        const maxDist = 40;
        const dist = Math.min(Math.hypot(dx, dy), maxDist);
        const angle = Math.atan2(dy, dx);
        dx = Math.cos(angle) * dist;
        dy = Math.sin(angle) * dist;

        stick.style.left = `${dx + 35}px`;
        stick.style.top = `${dy + 35}px`;

        player.mobileDir.x = dx / maxDist;
        player.mobileDir.y = dy / maxDist;
        });

        joystickElement.addEventListener("pointerup", e => {
        dragging = false;
        stick.style.transition = "all 0.2s ease";
        stick.style.left = "35px";
        stick.style.top = "35px";
        player.mobileDir.x = 0;
        player.mobileDir.y = 0;
        });

        joystickElement.addEventListener("pointercancel", () => {
        dragging = false;
        stick.style.transition = "all 0.2s ease";
        stick.style.left = "35px";
        stick.style.top = "35px";
        player.mobileDir.x = 0;
        player.mobileDir.y = 0;
        });
    }

    setupJoystick(document.getElementById("joystick1"), { mobileDir: {x:0,y:0} });
    setupJoystick(document.getElementById("joystick2"), { mobileDir: {x:0,y:0} });

    // Başlatma butonu
    startBtn.addEventListener("click", () => {
        // Ayarları oku
        gameMode = document.getElementById("mode").value;
        scoreLimit = parseInt(document.getElementById("scoreLimit").value);
        timeLimit = parseInt(document.getElementById("timeLimit").value) * 60; // saniye
        ballType = document.getElementById("ballType").value;
        playerSpeed = parseFloat(document.getElementById("playerSpeed").value);

        let p1Name = document.getElementById("player1Name").value.trim();
        if(!p1Name) p1Name = "Kırmızı";

        let p2Name = document.getElementById("player2Name").value.trim();
        if(!p2Name) p2Name = (gameMode === "1vbot") ? "Bot" : "Mavi";

        player1 = new Player(100, HEIGHT/2, "red", {
        up: "w", down: "s", left: "a", right: "d"
        }, p1Name, playerSpeed);

        player2 = new Player(WIDTH - 100, HEIGHT/2, "blue", {
        up: "arrowup", down: "arrowdown", left: "arrowleft", right: "arrowright"
        }, p2Name, playerSpeed);

        // Bot mu?
        if(gameMode === "1vbot") player2.isBot = true;
        else player2.isBot = false;

        ball = new Ball(WIDTH/2, HEIGHT/2, ballType);

        // Menü gizle, oyun göster
        menu.style.display = "none";
        canvas.style.display = "block";
        scoreboard.style.display = "block";
        timerEl.style.display = "block";
        resetBtn.style.display = "none";
        statsEl.style.display = "block";
        document.getElementById("mobileControls").style.display = "flex";

        resetGame();
        gameLoop();
    });

    resetBtn.addEventListener("click", () => {
        resetGame();
        message.textContent = "";
        resetBtn.style.display = "none";
    });

    </script>
    </body>
    </html>
